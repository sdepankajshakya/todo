{"ast":null,"code":"import { moveItemInArray, transferArrayItem } from '@angular/cdk/drag-drop';\nimport { EventEmitter } from '@angular/core';\nimport { MatAccordion } from '@angular/material/expansion';\nimport { Subscription } from 'rxjs';\nimport { ColorPaletteComponent } from '../shared/components/color-palette/color-palette.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/task.service\";\nimport * as i2 from \"../services/shared.service\";\nimport * as i3 from \"@angular/material/bottom-sheet\";\nimport * as i4 from \"../shared/services/notification.service\";\nimport * as i5 from \"@angular/material/card\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../shared/components/text-editable-directive\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"@angular/material/icon\";\nimport * as i10 from \"@angular/material/input\";\nimport * as i11 from \"@angular/material/datepicker\";\nimport * as i12 from \"@angular/cdk/drag-drop\";\nimport * as i13 from \"@angular/material/checkbox\";\nimport * as i14 from \"@angular/material/form-field\";\nimport * as i15 from \"@angular/material/button\";\nconst _c0 = function (a0) {\n  return {\n    background: a0\n  };\n};\nconst _c1 = function (a0, a1) {\n  return {\n    \"task-completed\": a0,\n    \"light-text\": a1\n  };\n};\nfunction TaskComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20)(1, \"div\", 21);\n    i0.ɵɵelement(2, \"img\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"mat-checkbox\", 23);\n    i0.ɵɵlistener(\"change\", function TaskComponent_div_19_Template_mat_checkbox_change_3_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const subtask_r3 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.markAsComplete($event.checked, subtask_r3);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 24, 4);\n    i0.ɵɵlistener(\"ngModelChange\", function TaskComponent_div_19_Template_div_ngModelChange_4_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const subtask_r3 = restoredCtx.$implicit;\n      return subtask_r3.name = $event;\n    })(\"blur\", function TaskComponent_div_19_Template_div_blur_4_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.onTaskNameChange();\n    });\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"mat-icon\", 25);\n    i0.ɵɵlistener(\"click\", function TaskComponent_div_19_Template_mat_icon_click_7_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const subtask_r3 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.onDeleteSubtask(subtask_r3);\n    });\n    i0.ɵɵtext(8, \"delete\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const subtask_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(5, _c0, ctx_r2.task.bgColor));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"checked\", subtask_r3.isCompleted);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", subtask_r3.name)(\"ngClass\", i0.ɵɵpureFunction2(7, _c1, subtask_r3.isCompleted, ctx_r2.task.isDark));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.task.name);\n  }\n}\nexport let TaskComponent = /*#__PURE__*/(() => {\n  class TaskComponent {\n    constructor(taskService, sharedService, bottomSheet, notifier) {\n      this.taskService = taskService;\n      this.sharedService = sharedService;\n      this.bottomSheet = bottomSheet;\n      this.notifier = notifier;\n      this.getBoard = new EventEmitter();\n      this.colorChangeSubscription = new Subscription();\n      this.subtaskName = '';\n      this.selectedTask = {\n        name: '',\n        dueDate: null,\n        priority: 0,\n        subtasks: [],\n        boardName: '',\n        bgColor: '',\n        isDark: false\n      };\n      this.bgColor = '';\n      this.brightness = '';\n      this.r = 0;\n      this.g = 0;\n      this.b = 0;\n      this.colorChangeSubscription = this.sharedService.$color.subscribe(paint => {\n        const color = paint;\n        this.setTaskColor(color);\n      });\n    }\n    ngOnInit() {\n      this.adjustTextColor();\n    }\n    addSubtask() {\n      if (this.subtaskName && this.task) {\n        const subtask = {\n          name: this.subtaskName,\n          isCompleted: false,\n          taskName: this.task.name,\n          boardName: this.task.boardName\n        };\n        this.task.subtasks.push(subtask);\n        this.saveNewSubtask(subtask);\n      }\n      this.subtaskName = '';\n    }\n    saveNewSubtask(subtask) {\n      this.taskService.saveNewSubtask(subtask).subscribe(res => {\n        const response = res;\n        // this.getBoard.emit();\n        this.notifier.showSuccess(response.message);\n      }, err => {\n        throw new Error(err.message);\n      });\n    }\n    markAsComplete(checked, subtask) {\n      if (subtask) {\n        subtask.isCompleted = checked;\n        subtask.taskName = this.task.name;\n      }\n      this.updateSubtask(subtask);\n    }\n    onDueDateChange() {\n      this.updateTask();\n    }\n    updateTask() {\n      this.taskService.updateTask(this.task).subscribe(res => {\n        // this.getBoard.emit();\n      }, err => {\n        throw new Error(err.message);\n      });\n    }\n    onDeleteTask() {\n      if (confirm(`Are you sure you want to delete card \"${this.task.name}\"?`)) {\n        this.taskService.deleteTask(this.task).subscribe(res => {\n          const response = res;\n          this.notifier.showSuccess(response.message);\n          this.getBoard.emit();\n        }, err => {\n          throw new Error(err.message);\n        });\n      }\n    }\n    updateSubtask(subtask) {\n      this.taskService.updateSubtask(subtask).subscribe(res => {\n        // this.getBoard.emit();\n      }, err => {\n        throw new Error(err.message);\n      });\n    }\n    drop(event) {\n      if (event.previousContainer === event.container) {\n        moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);\n      } else {\n        transferArrayItem(event.previousContainer.data, event.container.data, event.previousIndex, event.currentIndex);\n      }\n    }\n    updateBoard() {\n      this.taskService.updateBoard(this.board).subscribe(res => {}, err => {\n        throw new Error(err.message);\n      });\n    }\n    setTaskColor(color) {\n      var _a;\n      if (color) {\n        this.selectedTask.bgColor = color;\n        if ((_a = this.selectedTask) === null || _a === void 0 ? void 0 : _a.name) {\n          this.updateBoard();\n          this.reset();\n          this.adjustTextColor();\n        }\n      }\n    }\n    openColorPalette(task) {\n      this.selectedTask = task;\n      this.bottomSheet.open(ColorPaletteComponent);\n    }\n    reset() {\n      this.selectedTask = {\n        name: '',\n        dueDate: null,\n        priority: 0,\n        subtasks: [],\n        boardName: '',\n        bgColor: '',\n        isDark: false\n      };\n    }\n    onDeleteSubtask(subtask) {\n      if (confirm(`Are you sure you want to delete \"${subtask.name}\"?`)) {\n        this.taskService.deleteSubtask(subtask).subscribe(res => {\n          const response = res;\n          this.notifier.showSuccess(response.message);\n          this.getBoard.emit();\n        }, err => {\n          throw new Error(err.message);\n        });\n      }\n    }\n    onTaskNameChange() {\n      var _a, _b, _c;\n      // taskName in subtasks should also be updated\n      if (((_a = this.task) === null || _a === void 0 ? void 0 : _a.name) && ((_c = (_b = this.task) === null || _b === void 0 ? void 0 : _b.subtasks) === null || _c === void 0 ? void 0 : _c.length)) {\n        this.task.subtasks.forEach(subtask => {\n          subtask.taskName = this.task.name;\n        });\n      }\n      this.updateTask();\n    }\n    ngOnDestroy() {\n      this.colorChangeSubscription.unsubscribe();\n    }\n    adjustTextColor() {\n      this.bgColor = this.hexToRGB(this.task.bgColor);\n      // Call lightOrDark function to get the brightness (light or dark)\n      this.brightness = this.lightOrDark(this.bgColor);\n      // If the background color is dark, add the light-text class to it\n      if (this.brightness == 'dark') {\n        this.task.isDark = true;\n        // this.element.classList.add('light-text');\n      } else {\n        this.task.isDark = false;\n        // this.element.classList.add('dark-text');\n      }\n    }\n    lightOrDark(color) {\n      // Check the format of the color, HEX or RGB?\n      if (color.match(/^rgb/)) {\n        // If HEX --> store the red, green, blue values in separate variables\n        color = color.match(/^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)$/);\n        this.r = color[1];\n        this.g = color[2];\n        this.b = color[3];\n      } else {\n        // If RGB --> Convert it to HEX: http://gist.github.com/983661\n        color = +('0x' + color.slice(1).replace(color.length < 5 && /./g, '$&$&'));\n        this.r = color >> 16;\n        this.g = color >> 8 & 255;\n        this.b = color & 255;\n      }\n      // HSP (Highly Sensitive Poo) equation from http://alienryderflex.com/hsp.html\n      this.hsp = Math.sqrt(0.299 * (this.r * this.r) + 0.587 * (this.g * this.g) + 0.114 * (this.b * this.b));\n      // Using the HSP value, determine whether the color is light or dark\n      if (this.hsp > 127.5) {\n        return 'light';\n      } else {\n        return 'dark';\n      }\n    }\n    hexToRGB(h) {\n      let r = 0;\n      let b = 0;\n      let g = 0;\n      // 3 digits\n      if (h.length == 4) {\n        r = '0x' + h[1] + h[1];\n        g = '0x' + h[2] + h[2];\n        b = '0x' + h[3] + h[3];\n        // 6 digits\n      } else if (h.length == 7) {\n        r = '0x' + h[1] + h[2];\n        g = '0x' + h[3] + h[4];\n        b = '0x' + h[5] + h[6];\n      }\n      return 'rgb(' + +r + ',' + +g + ',' + +b + ')';\n    }\n  }\n  TaskComponent.ɵfac = function TaskComponent_Factory(t) {\n    return new (t || TaskComponent)(i0.ɵɵdirectiveInject(i1.TaskService), i0.ɵɵdirectiveInject(i2.SharedService), i0.ɵɵdirectiveInject(i3.MatBottomSheet), i0.ɵɵdirectiveInject(i4.NotificationService));\n  };\n  TaskComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TaskComponent,\n    selectors: [[\"app-task\"]],\n    viewQuery: function TaskComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(MatAccordion, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.accordion = _t.first);\n      }\n    },\n    inputs: {\n      task: \"task\",\n      board: \"board\"\n    },\n    outputs: {\n      getBoard: \"getBoard\"\n    },\n    decls: 27,\n    vars: 18,\n    consts: [[1, \"task-card\", 3, \"ngStyle\", \"ngClass\"], [1, \"card-control\"], [\"src\", \"../../assets/icons/palette.png\", 1, \"color-picker-icon\", 3, \"click\"], [\"text-editable\", \"\", 3, \"ngModel\", \"ngModelChange\", \"blur\"], [\"taskNameDiv\", \"ngModel\"], [1, \"delete-task\", 3, \"click\"], [1, \"task-header\"], [1, \"task-subtitle\"], [3, \"hidden\", \"ngClass\"], [\"matInput\", \"\", \"placeholder\", \"Due date\", 3, \"hidden\", \"matDatepicker\", \"ngClass\", \"ngModel\", \"ngModelChange\"], [\"matIconSuffix\", \"\", 3, \"for\", \"ngClass\"], [\"picker\", \"\"], [1, \"subtasks-list\"], [\"cdkDropList\", \"\", 1, \"mg-r1\", 3, \"cdkDropListData\", \"cdkDropListDropped\"], [\"class\", \"box\", \"cdkDrag\", \"\", \"cdkDragLockAxis\", \"y\", 3, \"ngStyle\", 4, \"ngFor\", \"ngForOf\"], [1, \"form-field\"], [3, \"ngClass\"], [\"matInput\", \"\", \"type\", \"text\", 3, \"ngModel\", \"ngModelChange\", \"keyup.enter\"], [\"matSuffix\", \"\", \"mat-icon-button\", \"\", \"aria-label\", \"Add Subtask\", 3, \"click\"], [1, \"green\", \"font-icon\"], [\"cdkDrag\", \"\", \"cdkDragLockAxis\", \"y\", 1, \"box\", 3, \"ngStyle\"], [\"cdkDragHandle\", \"\", 1, \"cdk-drag-handle\"], [\"aria-hidden\", \"\", \"src\", \"../../assets/icons/move.png\", \"alt\", \"move-icon\", 1, \"move-updown-icon\"], [1, \"circular-checkbox\", 3, \"checked\", \"change\"], [\"text-editable\", \"\", 1, \"wrap-text\", \"start-text\", \"pd-0\", 3, \"ngModel\", \"ngClass\", \"ngModelChange\", \"blur\"], [1, \"icon-delete\", \"font-icon\", 3, \"click\"]],\n    template: function TaskComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"mat-card\", 0)(1, \"div\", 1)(2, \"img\", 2);\n        i0.ɵɵlistener(\"click\", function TaskComponent_Template_img_click_2_listener() {\n          return ctx.openColorPalette(ctx.task);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"mat-card-title\")(4, \"div\", 3, 4);\n        i0.ɵɵlistener(\"ngModelChange\", function TaskComponent_Template_div_ngModelChange_4_listener($event) {\n          return ctx.task.name = $event;\n        })(\"blur\", function TaskComponent_Template_div_blur_4_listener() {\n          return ctx.onTaskNameChange();\n        });\n        i0.ɵɵtext(6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(7, \"mat-icon\", 5);\n        i0.ɵɵlistener(\"click\", function TaskComponent_Template_mat_icon_click_7_listener() {\n          return ctx.onDeleteTask();\n        });\n        i0.ɵɵtext(8, \"cancel\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(9, \"mat-card-header\", 6)(10, \"mat-card-subtitle\", 7)(11, \"label\", 8);\n        i0.ɵɵtext(12, \"No due date\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"input\", 9);\n        i0.ɵɵlistener(\"ngModelChange\", function TaskComponent_Template_input_ngModelChange_13_listener($event) {\n          return ctx.task.dueDate = $event;\n        })(\"ngModelChange\", function TaskComponent_Template_input_ngModelChange_13_listener() {\n          return ctx.onDueDateChange();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(14, \"mat-datepicker-toggle\", 10)(15, \"mat-datepicker\", null, 11);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(17, \"mat-card-content\", 12)(18, \"div\", 13);\n        i0.ɵɵlistener(\"cdkDropListDropped\", function TaskComponent_Template_div_cdkDropListDropped_18_listener($event) {\n          return ctx.drop($event);\n        });\n        i0.ɵɵtemplate(19, TaskComponent_div_19_Template, 9, 10, \"div\", 14);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(20, \"mat-form-field\", 15)(21, \"mat-label\", 16);\n        i0.ɵɵtext(22, \"Add subtask\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"input\", 17);\n        i0.ɵɵlistener(\"ngModelChange\", function TaskComponent_Template_input_ngModelChange_23_listener($event) {\n          return ctx.subtaskName = $event;\n        })(\"keyup.enter\", function TaskComponent_Template_input_keyup_enter_23_listener() {\n          return ctx.addSubtask();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"button\", 18);\n        i0.ɵɵlistener(\"click\", function TaskComponent_Template_button_click_24_listener() {\n          return ctx.addSubtask();\n        });\n        i0.ɵɵelementStart(25, \"mat-icon\", 19);\n        i0.ɵɵtext(26, \"add_circle\");\n        i0.ɵɵelementEnd()()()();\n      }\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(16);\n        i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(16, _c0, ctx.task.bgColor))(\"ngClass\", ctx.task.isDark ? \"light-text\" : \"dark-text\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.task.name);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.task.name);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"hidden\", ctx.task.dueDate)(\"ngClass\", ctx.task.isDark ? \"light-text\" : \"dark-text\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"hidden\", !ctx.task.dueDate)(\"matDatepicker\", _r1)(\"ngClass\", ctx.task.isDark ? \"light-text\" : \"dark-text\")(\"ngModel\", ctx.task.dueDate);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"for\", _r1)(\"ngClass\", ctx.task.isDark ? \"light-text\" : \"dark-text\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"cdkDropListData\", ctx.task.subtasks);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.task.subtasks);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngClass\", ctx.task.isDark ? \"light-text\" : \"dark-text\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.subtaskName);\n      }\n    },\n    directives: [i5.MatCard, i6.NgStyle, i6.NgClass, i5.MatCardTitle, i7.TextEditableComponent, i8.NgControlStatus, i8.NgModel, i9.MatIcon, i5.MatCardHeader, i5.MatCardSubtitle, i10.MatInput, i11.MatDatepickerInput, i8.DefaultValueAccessor, i11.MatDatepickerToggle, i11.MatDatepicker, i5.MatCardContent, i12.CdkDropList, i6.NgForOf, i12.CdkDrag, i12.CdkDragHandle, i13.MatCheckbox, i14.MatFormField, i14.MatLabel, i15.MatButton, i14.MatSuffix],\n    styles: [\".box[_ngcontent-%COMP%]{position:relative;padding-top:10px;padding-left:5px;border-bottom:solid 1px #ccc;color:#000000de;flex-direction:row;align-items:center;box-sizing:border-box;background:white;font-size:14px;display:flex;align-items:flex-start;gap:1rem}.icon-delete[_ngcontent-%COMP%]{position:absolute;right:0}.cdk-drag-handle[_ngcontent-%COMP%]{cursor:move;width:1rem;height:1rem}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .example-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.task-card[_ngcontent-%COMP%]{box-shadow:5px 5px 7px #212121b3}.subtasks-list[_ngcontent-%COMP%]{max-width:25rem;max-height:20rem;overflow:auto}.card-control[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:3rem}.delete-task[_ngcontent-%COMP%]{color:#c41e3a;cursor:pointer}.form-field[_ngcontent-%COMP%]{width:100%}.task-header[_ngcontent-%COMP%]{display:block}.task-subtitle[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}.task-completed[_ngcontent-%COMP%]{text-decoration:line-through}  mat-checkbox .mat-checkbox-frame{background:white}.light-text[_ngcontent-%COMP%]{color:#fff}.dark-text[_ngcontent-%COMP%]{color:#000}  .mat-form-field-outline{opacity:0}  .mat-form-field-appearance-outline{padding:0!important;width:100%}  .circular-checkbox .mat-checkbox-background,   .circular-checkbox .mat-checkbox-frame{border-radius:70%!important}  .mat-expansion-panel-body{padding:0!important}  .mat-checkbox-inner-container{width:22px!important;height:22px!important}  .mat-card-title{font-size:20px;margin-bottom:0}  .mat-card-header-text{display:flex;justify-content:center}\"]\n  });\n  return TaskComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}